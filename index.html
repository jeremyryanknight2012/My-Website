<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SME Launcher</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    @font-face {
      font-family: "Comic Sans MS";
      src: local("Comic Sans MS");
    }

    :root {
      --bg: #0f0f0f;
      --bg2: #1a1a1a;
      --text: #fff;
      --accent: #4caf50;
      --sidebar: #000;
      --banner1: #000;
      --banner2: #0f0f0f;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: "Comic Sans MS";
      overflow-x: hidden;
    }

    body.light {
      --bg: #f5f5f5;
      --bg2: #ffffff;
      --text: #111;
      --accent: #2196f3;
      --sidebar: #222;
    }

    /* SIDEBAR */
    #sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 75px;
      height: 100%;
      background: var(--sidebar);
      padding-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1000;
    }

    #sidebar div {
      padding: 15px;
      cursor: pointer;
      text-align: center;
      font-size: 24px;
      transition: 0.2s;
    }

    #sidebar div:hover {
      transform: scale(1.2);
    }

    /* MAIN */
    #main {
      margin-left: 90px;
      padding: 20px;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }
    #homeDashboard {
      padding: 20px;
      animation: fadeIn 0.4s ease;
    }

    .homeCard {
      background: var(--bg2);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px #0005;
    }

    .postBox {
      background: #222;
      padding: 12px;
      border-radius: 10px;
      margin: 10px 0;
    }

    .postAuthor { font-weight: bold; color: var(--accent); }
    .postTime { opacity: 0.6; font-size: 11px; }
    .postActions { margin-top: 5px; font-size: 13px; opacity: 0.8; display: flex; gap: 15px; }

    .card {
      background: var(--bg2);
      width: 180px;
      height: 320px;
      border-radius: 12px;
      padding: 12px;
      display: inline-flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      margin: 8px;
      cursor: pointer;
      transition: 0.2s;
      position: relative;
      vertical-align: top;
    }

    .card:hover { transform: translateY(-6px) scale(1.05); }

    .card img {
      width: 100%;
      height: 260px;
      object-fit: cover;
      border-radius: 10px;
    }

    .star {
      position: absolute;
      top: 8px;
      left: 8px;
      font-size: 20px;
      cursor: pointer;
      color: #777;
    }

    .star.fav {
      color: gold;
      text-shadow: 0 0 10px gold;
    }

    #embedWin {
      display: none;
      position: fixed;
      inset: 0;
      background: #000d;
      z-index: 9999;
    }

    #embedFrame { width: 100%; height: 100%; border: none; }

    .profileBanner {
      width: 100%;
      height: 90px;
      background: linear-gradient(90deg, var(--accent), transparent);
      border-radius: 12px;
    }

    .profileAvatar {
      width: 96px;
      height: 96px;
      border-radius: 50%;
      border: 3px solid var(--bg2);
      margin-top: -48px;
      margin-left: 15px;
      background: #333;
    }

    .tabBtn {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      background: #222;
      color: var(--text);
      cursor: pointer;
    }

    .tabBtn:hover { background: var(--accent); }

    #settingsContent {
      background: var(--bg2);
      padding: 15px;
      border-radius: 10px;
    }

    .sme-toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #333;
      color: #fff;
      padding: 10px 14px;
      border-radius: 8px;
      box-shadow: 0 0 10px #000;
      font-size: 14px;
      opacity: 0;
      transition: 0.25s;
      z-index: 10000;
    }

    .sme-toast.success { background: #2e7d32; }
    .sme-toast.info { background: #1976d2; }
    .sme-toast.error { background: #c62828; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body>
  <div id="sidebar">
    <div onclick="nav('homeDashboard')">üè†</div>
    <div onclick="nav('games')">üéÆ</div>
    <div onclick="nav('downloads')">‚¨á</div>
    <div onclick="nav('favorites')">‚≠ê</div>
    <div onclick="nav('theater')">üé¨</div>
    <div onclick="nav('friends')">üë•</div>
    <div onclick="nav('profile')">üë§</div>
    <div onclick="openSettings()">‚öôÔ∏è</div>
    <div onclick="toggleTheme()">üåó</div>
    <div onclick="panic()">‚ö†</div>
  </div>

  <div id="main">
    <h1 id="pageTitle">Home</h1>

    <div id="homeDashboard" class="section active">
      <div class="homeCard">
        <h2>Welcome back!</h2>
        <p>Your personalized SME Dashboard</p>
      </div>

      <div id="continuePlaying" class="homeCard">
        <h3>Continue Playing</h3>
        <div id="continueList"></div>
      </div>

      <div id="socialFeed" class="homeCard">
        <h3>Social Feed</h3>
        <div id="feedPosts"></div>
        <textarea id="feedInput" placeholder="Share something..."
          style="width:100%;height:60px;padding:10px;border:none;border-radius:8px;background:#222;color:white;margin-top:10px;"></textarea>
        <button onclick="postToFeed()"
          style="padding:10px;margin-top:8px;width:100%;border:none;border-radius:8px;background:var(--accent);color:white;">
          Post
        </button>
      </div>
      <div id="friendsOnline" class="homeCard">
        <h3>Friends Online</h3>
        <div id="onlineList"></div>
      </div>

      <div id="activityLog" class="homeCard">
        <h3>Recent Activity</h3>
        <div id="activityList"></div>
      </div>
    </div>

    <!-- Sections -->
    <div id="games" class="section"></div>
    <div id="downloads" class="section"></div>
    <div id="favorites" class="section"></div>
    <div id="theater" class="section"></div>
    <div id="friends" class="section"></div>
    <div id="profile" class="section"></div>
    <div id="settingsPage" class="section">
      <div id="settingsContent"></div>
    </div>
  </div>

  <!-- EMBED WINDOW -->
  <div id="embedWin"><iframe id="embedFrame"></iframe></div>

  <!-- GAME MODAL -->
  <div id="gameModal"
    style="display:none;position:fixed;inset:0;background:#000a;z-index:9999;align-items:center;justify-content:center;">
    <div id="modalBox"
      style="width:420px;background:var(--bg2);padding:20px;border-radius:15px;box-shadow:0 0 20px #000;color:white;">
      <img id="modalImg" style="width:100%;border-radius:10px;">
      <h2 id="modalTitle"></h2>
      <p id="modalDesc"></p>
      <div id="playtimeBox"></div>
      <button id="playBtn" style="padding:10px;width:100%;border:none;border-radius:8px;background:var(--accent);color:white;">Play</button>
      <button onclick="closeGameModal()"
        style="padding:10px;width:100%;border:none;border-radius:8px;background:#333;color:white;">Close</button>
    </div>
  </div>

  <script>
    /* ============================
          GLOBAL NAV
    ============================ */

    function nav(id) {
      document.querySelectorAll(".section").forEach((s) => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");

      const titleMap = {
        homeDashboard: "Home",
        games: "Games",
        downloads: "Downloads",
        favorites: "Favorites",
        theater: "SME Theater",
        friends: "Friends",
        profile: "Profile",
        settingsPage: "Settings",
      };

      document.getElementById("pageTitle").textContent = titleMap[id] || "SME";

      if (id === "theater") loadTheater();
    }

    function toggleTheme() { document.body.classList.toggle("light"); }
    function panic() { location.href = "https://classroom.google.com"; }
    function enc(u) { return u; }

    function notify(msg, type = "info") {
      const t = document.createElement("div");
      t.className = "sme-toast " + type;
      t.textContent = msg;
      document.body.appendChild(t);
      requestAnimationFrame(() => t.style.opacity = 1);
      setTimeout(() => { t.style.opacity = 0; setTimeout(() => t.remove(), 250); }, 2500);
    }

    /* ============================
            GAMES SYSTEM
    ============================ */

    let recent = JSON.parse(localStorage.getItem("recent") || "[]");
    let activity = JSON.parse(localStorage.getItem("activity") || "[]");
    let friends = JSON.parse(localStorage.getItem("friends") || "[]");

    let storedProfile = localStorage.getItem("profile");
    let profile = storedProfile ? JSON.parse(storedProfile) : {
      username: "Player",
      bio: "",
      status: "Online",
      avatar: "https://i.imgur.com/1X5Rz.png",
    };

    let friendCode = localStorage.getItem("friendCode") || ("SME-" + Math.random().toString(36).substring(2, 8).toUpperCase());
    localStorage.setItem("friendCode", friendCode);

    let games = [
      { name: "Slime Rancher", img: "thumbnails/slimerancher.png", url: "https://jeremy4401.github.io/SME/games/slimerancher.html", cat: "Action" },
      { name: "Minecraft", img: "thumbnails/minecraft.png", url: "https://jeremy4401.github.io/SME/games/minecraft.html", cat: "Survival" },
      { name: "Buckshot Roulette", img: "thumbnails/buckshotroulette.png", url: "https://jeremy4401.github.io/SME/games/buckshotroulette.html", cat: "Horror" },
      { name: "Schoolboy Runaway", img: "thumbnails/schoolboyrunaway.png", url: "https://jeremy4401.github.io/SME/games/schoolboyrunaway.html", cat: "Survival" },
      { name: "Hollow Knight", img: "thumbnails/hollowknight.png", url: "https://jeremy4401.github.io/SME/games/hollowknight.html", cat: "Action" },
      { name: "Basket Bros", img: "thumbnails/basketbros.png", url: "https://jeremy4401.github.io/SME/games/basketbros.html", cat: "Survival" },
      { name: "10 Minutes Till Dawn", img: "thumbnails/10minutestilldawn.png", url: "https://jeremy4401.github.io/SME/games/10minutestilldawn.html", cat: "Action" },
      { name: "1v1.LOL", img: "thumbnails/1v1lol.png", url: "https://jeremy4401.github.io/SME/games/1v1lol.html", cat: "Action" },
      { name: "Amanda the Adventurer", img: "thumbnails/amandatheadventurer.png", url: "https://jeremy4401.github.io/SME/games/amandatheadventurer.html", cat: "Action" },
      { name: "The Backrooms", img: "thumbnails/thebackrooms.png", url: "https://jeremy4401.github.io/SME/games/thebackrooms.html", cat: "Action" },
      { name: "Bank Robbery 2", img: "thumbnails/bankrobbery2.png", url: "https://jeremy4401.github.io/Bank-Robbery-2", cat: "Action" },
      { name: "Basket Random", img: "thumbnails/basketrandom.png", url: "https://jeremy4401.github.io/Basket-Random", cat: "Action" },
      { name: "Basketball Stars", img: "thumbnails/basketballstars.png", url: "https://jeremy4401.github.io/Basketball-Stars", cat: "Action" },
      { name: "ULTRAKILL", img: "thumbnails/ultrakill.png", url: "https://jeremy4401.github.io/Ultrakill", cat: "Action" },
      { name: "Kindergarten", img: "thumbnails/kindergarten.png", url: "https://jeremy4401.github.io/Kindergarten", cat: "Action" },
      { name: "Kindergarten 2", img: "thumbnails/kindergarten2.png", url: "https://jeremy4401.github.io/Kindergarten-2", cat: "Action" },
      { name: "Kindergarten 3", img: "thumbnails/kindergarten3.png", url: "https://jeremy4401.github.io/Kindergarten-3", cat: "Action" },
      { name: "Baldi's Basics", img: "thumbnails/baldisbasics.png", url: "https://jeremy4401.github.io/Baldis-Basics", cat: "Horror" },
      { name: "Bendy & The Ink Machine", img: "thumbnails/bendy.png", url: "https://jeremy4401.github.io/Bendy", cat: "Action" },
      { name: "Cuphead", img: "thumbnails/cuphead.png", url: "https://jeremy4401.github.io/Cuphead", cat: "Action" },
      { name: "Half Life", img: "thumbnails/halflife.png", url: "https://jeremy4401.github.io/Half-Life", cat: "Action" },
      { name: "R.E.P.O.", img: "thumbnails/repo.png", url: "https://jeremy4401.github.io/Repo", cat: "Action" },
      { name: "That's Not My Neighbor", img: "thumbnails/thatsnotmyneighbor.png", url: "https://jeremy4401.github.io/Thats-Not-my-Neighbor", cat: "Action" },
      { name: "Bad Parenting", img: "thumbnails/badparenting.png", url: "https://jeremy4401.github.io/Bad-Parenting/", cat: "Horror" }
    ];

    let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");

    function renderGames() {
      const sec = document.getElementById("games");
      const searchVal = (document.getElementById("gameSearch")?.value || "").toLowerCase().trim();
      const sortVal = document.getElementById("sortSelect")?.value || "none";

      let list = games.filter((g) => g.name.toLowerCase().includes(searchVal));

      if (sortVal === "az") list.sort((a, b) => a.name.localeCompare(b.name));
      if (sortVal === "za") list.sort((a, b) => b.name.localeCompare(a.name));
      if (sortVal === "fav") list = list.filter((g) => favorites.includes(g.name));
      if (sortVal === "recent") list = recent.map((r) => games.find((g) => g.name === r)).filter(Boolean);

      let html = `
        <div style="margin-bottom:15px;">
          <input id="gameSearch" placeholder="Search games..."
            style="padding:10px;width:240px;border-radius:8px;background:#222;border:none;color:white;"
            oninput="renderGames()">
          <select id="sortSelect"
            style="padding:10px;border-radius:8px;background:#222;color:white;border:none;"
            onchange="renderGames()">
            <option value="none">Sort: None</option>
            <option value="az">A ‚Üí Z</option>
            <option value="za">Z ‚Üí A</option>
            <option value="fav">Favorites</option>
            <option value="recent">Recently Played</option>
          </select>
        </div>

        <div id="gameCards" style="white-space:nowrap;overflow-x:auto;padding-bottom:10px;">
      `;

      list.forEach((g) => {
        const isFav = favorites.includes(g.name) ? "fav" : "";
        html += `
          <div class="card" onclick="launchGame('${g.name}')">
            <div class="star ${isFav}" onclick="toggleFav('${g.name}');event.stopPropagation();">‚òÖ</div>
            <img src="${g.img}">
            <button>${g.name}</button>
          </div>`;
      });

      html += `</div>`;
      sec.innerHTML = html;
    }

    function renderFavorites() {
      const sec = document.getElementById("favorites");
      sec.innerHTML = "";

      if (favorites.length === 0) {
        sec.innerHTML = "<p>No favorites yet.</p>";
        return;
      }

      favorites.forEach((f) => {
        const g = games.find((x) => x.name === f);
        if (!g) return;
        sec.innerHTML += `
          <div class="card" onclick="launchGame('${g.name}')">
            <img src="${g.img}">
            <button>${g.name}</button>
          </div>
        `;
      });
    }

    function renderFriends() {
      const sec = document.getElementById("friends");

      sec.innerHTML = `
        <h3>Your Friend Code:</h3>
        <div style="background:#222;padding:10px;border-radius:10px;margin-bottom:10px;">${friendCode}</div>

        <h3>Pending Requests</h3>
        <div id="reqList"></div>

        <h3>Your Friends</h3>
        <div id="friendList"></div>

        <h3>Add Friend</h3>
        <input id="addFriendCode" placeholder="Enter code"
          style="padding:10px;width:200px;border:none;border-radius:8px;background:#222;color:white;">
        <button onclick="sendFriendRequest()"
          style="padding:10px;border:none;border-radius:8px;background:var(--accent);color:white;margin-left:5px;">
          Add
        </button>

        <div id="friendProfile" style="margin-top:25px;display:none;"></div>
      `;

      loadRequests();
      loadFriends();
    }

    renderFriends();

    function renderProfile() {
      const sec = document.getElementById("profile");

      sec.innerHTML = `
        <div class="profileBanner"></div>
        <img class="profileAvatar" src="${profile.avatar}">

        <div style="margin-left:150px;margin-top:10px;">
          <h2>${profile.username}</h2>
          <p>Status: ${profile.status}</p>
          <p>Custom Status: ${statusData.customStatus}</p>
          <p>Rich Presence: <span style="color:var(--accent);">${statusData.rich || "None"}</span></p>
          <p>Bio: ${profile.bio || "No bio set."}</p>

          <h3>Edit Profile</h3>

          <input id="usernameInput" value="${profile.username}"
            style="padding:10px;width:260px;border-radius:8px;background:#222;color:white;"><br><br>

          <textarea id="bioInput"
            style="padding:10px;width:260px;height:70px;border-radius:8px;background:#222;color:white;">${profile.bio}</textarea><br><br>

          <select id="statusInput"
            style="padding:10px;width:260px;border-radius:8px;background:#222;color:white;">
            <option ${profile.status === "Online" ? "selected" : ""}>Online</option>
            <option ${profile.status === "Busy" ? "selected" : ""}>Busy</option>
            <option ${profile.status === "Offline" ? "selected" : ""}>Offline</option>
          </select><br><br>

          <input id="avatarInput" value="${profile.avatar}"
            style="padding:10px;width:260px;border-radius:8px;background:#222;color:white;"><br><br>

          <button onclick="saveProfileFull()"
            style="padding:10px;border:none;border-radius:8px;background:var(--accent);color:white;">
            Save
          </button>
        </div>

        <div id="xpBox" style="margin-top:20px;"></div>
        <div id="achList" style="margin-top:20px;"></div>
      `;

      updateProfileXP();
    }

    /* ============================
          THEATER PAGE
    ============================ */
    function loadTheater() {
      document.getElementById("theater").innerHTML = `
        <iframe src="https://jeremy4401.github.io/SME-Theater/"
          style="width:100%;height:90vh;border:none;border-radius:12px;background:#000;"></iframe>
      `;
    }

    /* ============================
       FINAL RENDERS + INIT
    ============================ */

    renderGames();
    renderFavorites();
    renderProfile();
    renderHome();
  </script>
</body>
</html>
